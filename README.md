# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Пользовательские данные

```
interface IUserData {
  payment: 'online' | 'atReceipt';
  email: string;
  phone: string;
  address: string;
}
```

Интерфейс для модели данных товаров

```
interface IItemsData {
  total: number;
  items: IItem[];
  preview: string | null;
}
```

Интерфейс для модели данных корзины

```
interface IOrderData {
  total: number | null;
  items: string[];
  userData: IUserData;
}
```

Данные товара, используемые в модальном окне товара

```
type TItemInfo = Pick<IItem, 'description' | 'image' | 'title' | 'category' | 'price'>;
```

Данные заказа пользователя в форме с информацией о доставке

```
type TUserDelivery = Pick<IUserData, 'payment' | 'address'>;
```

Данные заказа пользователя в форме с контактными данными

```
type TUserContacts = Pick<IUserData, 'email' | 'phone'>;
```

Данные заказа пользователя в корзине

```
type TUserOrder = Pick<IOrderData, 'total' | 'items'>;
```

Данные заказа пользователя в модальном окне успешного заказа

```
export type TUserSuccess = Pick<IOrderData, 'total'>;
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие  

### Слой данных

#### Класс ItemsData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _total: number - общее количество товаров
- _items: IItem[] - массив объектов товаров
- _preview: string | null - id товара, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getItem(id: string): IItem - возвращает объект товара по его id
- setItems(items: IItem[]): void - устанавливает массив объектов товаров и вызывает событие изменения массива
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа пользователя.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _total: number | null - общая стоимость заказа
- _items: string[] - массив id товаров в заказе
- _userData: IUserData - объект с данными пользователя
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addItem(id: string): void - добавляет id товара в заказ
- removeItem(id: string): void - удаляет id товара из заказа
- clear(): void - очищает заказ
- getItems(ids: string[]): IItem[] - возвращает массив объектов товаров в корзине по переданным id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Класс отвечает за отображение модального окна. Так же представляет методы 'open' и 'close' для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. 
- constructor